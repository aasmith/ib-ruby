<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: IB::IncomingMessages::TickPrice</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">IB::IncomingMessages::TickPrice</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/messages_rb.html">
                messages.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="AbstractMessage.html">
                AbstractMessage
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="../../IB.html">IB</a> code seems to dispatch up to two wrapped
objects for this message, a tickPrice and sometimes a tickSize, which seems
to be identical to the TICK_SIZE object.
</p>
<p>
Important note from <a
href="http://chuckcaplan.com/twsapi/index.php/void%20tickPrice%28%29">chuckcaplan.com/twsapi/index.php/void%20tickPrice%28%29</a>
:
</p>
<p>
&quot;The low you get is NOT the low for the day as you&#8217;d expect it
to be. It appears <a href="../../IB.html">IB</a> calculates the low based
on all transactions after 4pm the previous day. The most inaccurate results
occur when the stock moves up in the 4-6pm aftermarket on the previous day
and then gaps open upward in the morning. The low you receive from TWS can
be easily be several points different from the actual 9:30am-4pm low for
the day in cases like this. If you require a correct traded low for the
day, you can&#8217;t get it from the TWS API. One possible source to help
build the right data would be to compare against what Yahoo lists on
finance.yahoo.com/q?s=ticker under the &quot;Day&#8217;s Range&quot;
statistics (be careful here, because Yahoo will use anti-Denial of Service
techniques to hang your connection if you try to request too many bytes in
a short period of time from them). For most purposes, a good enough
approach would start by replacing the TWS low for the day with
Yahoo&#8217;s day low when you first start watching a stock ticker;
let&#8217;s call this time T. Then, update your internal low if the bid or
ask tick you receive is lower than that for the remainder of the day. You
should check against Yahoo again at time T+20min to handle the occasional
case where the stock set a new low for the day in between T-20min (the real
time your original quote was from, taking into account the delay) and time
T. After that you should have a correct enough low for the rest of the day
as long as you keep updating based on the bid/ask. It could still get
slightly off in a case where a short transaction setting a new low appears
in between ticks of data that TWS sends you. The high is probably distorted
in the same way the low is, which would throw your results off if the stock
traded after-hours and gapped down. It should be corrected in a similar way
as described above if this is important to you.&quot;
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000008">inspect</a>&nbsp;&nbsp;
      <a href="#M000007">load</a>&nbsp;&nbsp;
      <a href="#M000006">message_id</a>&nbsp;&nbsp;
      <a href="#M000009">to_human</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">message_id</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
     <span class="ruby-comment cmt"># File messages.rb, line 777</span>
777:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">message_id</span>
778:         <span class="ruby-value">1</span>
779:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">inspect</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
     <span class="ruby-comment cmt"># File messages.rb, line 809</span>
809:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
810:         <span class="ruby-value str">&quot;Tick (&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:type</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; at &quot;</span>  <span class="ruby-operator">+</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:price</span>].<span class="ruby-identifier">to_digits</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;) &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">super</span>.<span class="ruby-identifier">inspect</span>
811:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">load</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
     <span class="ruby-comment cmt"># File messages.rb, line 781</span>
781:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load</span>
782:         <span class="ruby-identifier">autoload</span>([<span class="ruby-identifier">:version</span>, <span class="ruby-identifier">:int</span>], [<span class="ruby-identifier">:ticker_id</span>, <span class="ruby-identifier">:int</span>], [<span class="ruby-identifier">:tick_type</span>, <span class="ruby-identifier">:int</span>], [<span class="ruby-identifier">:price</span>, <span class="ruby-identifier">:decimal</span>])
783:         
784:         <span class="ruby-identifier">version_load</span>(<span class="ruby-value">2</span>, [<span class="ruby-identifier">:size</span>, <span class="ruby-identifier">:int</span>])
785:         <span class="ruby-identifier">version_load</span>(<span class="ruby-value">3</span>, [<span class="ruby-identifier">:can_auto_execute</span>, <span class="ruby-identifier">:int</span>])
786:         
787:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:version</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>
788:           <span class="ruby-comment cmt"># the IB code translates these into 0, 3, and 5, respectively, and wraps them in a TICK_SIZE-type wrapper.</span>
789:           <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:type</span>] = <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:tick_type</span>]
790:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span>
791:                            <span class="ruby-identifier">:bid</span>
792:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span>
793:                            <span class="ruby-identifier">:ask</span>
794:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">4</span>
795:                            <span class="ruby-identifier">:last</span>
796:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">6</span>
797:                            <span class="ruby-identifier">:high</span>
798:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">7</span>
799:                            <span class="ruby-identifier">:low</span>
800:                          <span class="ruby-keyword kw">when</span> <span class="ruby-value">9</span>
801:                            <span class="ruby-identifier">:close</span>
802:                          <span class="ruby-keyword kw">else</span>
803:                            <span class="ruby-keyword kw">nil</span>
804:                          <span class="ruby-keyword kw">end</span>
805:         <span class="ruby-keyword kw">end</span>
806: 
807:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">to_human</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File messages.rb, line 813</span>
813:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_human</span>
814:         <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:size</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:type</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; at &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@data</span>[<span class="ruby-identifier">:price</span>].<span class="ruby-identifier">to_digits</span>
815:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>